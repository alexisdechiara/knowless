
# üß† Knowless

**Knowless** est une application web moderne construite avec **Nuxt 3**, pens√©e pour offrir une exp√©rience interactive riche autour du quiz. Elle repose sur des technologies web actuelles afin de garantir **performance**, **scalabilit√©** et **ergonomie**.

## ‚öôÔ∏è Fonctionnalit√©s Cl√©s

* **üñå Interface Moderne (UI/UX)** :
  Interface soign√©e, responsive et personnalisable gr√¢ce √† [Tailwind CSS](https://tailwindcss.tailwindcss.com/) et [shadcn-nuxt](https://www.shadcn-vue.com/), bas√© sur Radix Vue.

* **üìö Contenu Riche en Markdown** :
  G√©r√© par [`@nuxt/content`](https://content.nuxt.com/).

* **üéÆ Exp√©rience Interactive** :
  Animations fluides avec [@formkit/auto-animate](https://auto-animate.formkit.com/) et [motion-v](https://motion.vueuse.org/), compl√©t√©es par les composants Radix Vue.

* **üß† Gestion d‚Äô√âtat** :
  Bas√©e sur [Pinia](https://pinia.vuejs.org/), avec persistance via `pinia-plugin-persistedstate`.

* **üìã Formulaires Typ√©s** :
  Validation avec [VeeValidate](https://vee-validate.logaretm.com/) + [Zod](https://zod.dev/).

* **üõ† Backend Supabase** :
  Authentification, base de donn√©es et fonctions serveur avec [`@nuxtjs/supabase`](https://supabase.nuxt.com/).

* **üñº Optimisation des Images** :
  Via [`@nuxt/image`](https://image.nuxt.com/).

* **üîç SEO-friendly** :
  Optimis√© pour les moteurs de recherche avec [`@nuxtjs/seo`](https://seo.nuxt.com/).

* **üß© Ic√¥nes Modernes** :
  Fournies par Lucide Icons via [`@nuxt/icon`](https://icon.nuxt.com/).

* **üîî Notifications** :
  Int√©gr√©es avec [vue-sonner](https://github.com/AnandChowdhary/vue-sonner).

* **üì± D√©tection de l‚Äôappareil** :
  Fournie par [`@nuxtjs/device`](https://github.com/nuxt-modules/device).

* **üë§ Avatars G√©n√©ratifs** :
  Possibles avec [`@dicebear/core`](https://www.dicebear.com/).

## üóÇ Structure du Projet

```bash
knowless/
‚îú‚îÄ‚îÄ assets/           # Fichiers statiques (CSS, images, etc.)
‚îú‚îÄ‚îÄ components/       # Composants Vue globaux
‚îú‚îÄ‚îÄ composables/      # Fonctions r√©utilisables
‚îú‚îÄ‚îÄ content/          # Contenu Markdown
‚îú‚îÄ‚îÄ layouts/          # Gabarits de page
‚îú‚îÄ‚îÄ middleware/       # Middlewares Nuxt
‚îú‚îÄ‚îÄ pages/            # Pages de l‚Äôapplication
‚îú‚îÄ‚îÄ plugins/          # Plugins Nuxt
‚îú‚îÄ‚îÄ public/           # Fichiers publics
‚îÇ   ‚îî‚îÄ‚îÄ licenses.json
‚îú‚îÄ‚îÄ server/           # Code backend Nuxt
‚îú‚îÄ‚îÄ stores/           # Stores Pinia
‚îú‚îÄ‚îÄ utils/            # Fonctions utilitaires
‚îú‚îÄ‚îÄ app.vue
‚îú‚îÄ‚îÄ nuxt.config.ts
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ bun.lockb
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ README.md
```

## üöÄ D√©marrage Rapide

### üß© Pr√©requis

* Node.js (v18+ recommand√©)
* Bun

### üíª Installation

```bash
gh repo clone alexisdechiara/knowless
cd knowless
bun install
```

### üîß D√©veloppement

```bash
bun run dev
```

L‚Äôapplication sera disponible sur [http://localhost:3000](http://localhost:3000)
L‚Äôoption `--host` permet un acc√®s sur le r√©seau local.

### üì¶ Compilation

```bash
bun run build
```

R√©sultat : `.output/`

### üîç Pr√©visualisation

```bash
bun run preview
```

### üìú Scripts utiles (dans `package.json`)

| Script              | Description                                      |
|---------------------|-------------------------------------------------|
| `dev`               | Lance le serveur de dev avec `--host`           |
| `build`             | Compile pour la production                        |
| `preview`           | Sert la version build localement                  |
| `generate`          | G√©n√®re une version statique                       |
| `postinstall`       | Pr√©pare les types apr√®s install                   |
| `generate-licenses` | Exporte les licences dans `public/licenses.json` |


## üß© Configuration Supabase

### üìå Pr√©requis

Cr√©er un compte sur [supabase.com](https://supabase.com) et un projet.

### üîë R√©cup√©ration des informations

Depuis l‚Äôinterface Supabase :

* `Project URL`
* `Anon Public API Key`

Ajoutez-les dans `.env` :

```env
NUXT_PUBLIC_SUPABASE_URL=VOTRE_URL_SUPABASE
NUXT_PUBLIC_SUPABASE_ANON_KEY=VOTRE_CLE
```

## üóÉÔ∏è Sch√©ma de la Base de Donn√©es

### üìÑ Tables

#### `friendship`

```sql
CREATE TABLE public.friendship (
  id serial NOT NULL,
  user_id uuid NOT NULL,
  friend_id uuid NOT NULL,
  status text NULL DEFAULT 'pending'::text,
  created_at timestamp without time zone NULL DEFAULT now(),
  CONSTRAINT friendship_pkey PRIMARY KEY (id),
  CONSTRAINT friendship_user_id_friend_id_key UNIQUE (user_id, friend_id),
  CONSTRAINT friendship_friend_id_fkey FOREIGN KEY (friend_id) REFERENCES auth.users(id) ON DELETE CASCADE,
  CONSTRAINT friendship_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE
);
```

#### games

```sql
CREATE TABLE public.games (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  phase text NOT NULL DEFAULT 'start'::text,
  questions jsonb[] NULL,
  current_question_index numeric NULL DEFAULT '0'::numeric,
  current_player_index numeric NULL DEFAULT '0'::numeric,
  players_data jsonb[] NULL,
  CONSTRAINT games_pkey PRIMARY KEY (id)
);
```

#### lobbies

```sql
CREATE TABLE public.lobbies (
  id smallint NOT NULL DEFAULT (floor(((random() * (((9999 - 1000) + 1))::double precision) + (1000)::double precision)))::smallint,
  title text NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  security_level text[] NULL DEFAULT ARRAY['code'::text, 'join'::text],
  password text NULL,
  host uuid NOT NULL DEFAULT auth.uid(),
  players uuid[] NULL DEFAULT ARRAY[auth.uid()],
  invited_friends uuid[] NULL,
  is_public boolean NULL,
  friends_only boolean NULL,
  banned_players uuid[] NULL,
  max_players smallint NOT NULL DEFAULT '12'::smallint,
  game_id bigint NULL,
  CONSTRAINT lobbies_pkey PRIMARY KEY (id),
  CONSTRAINT lobbies_id_key UNIQUE (id),
  CONSTRAINT lobbies_game_id_fkey FOREIGN KEY (game_id) REFERENCES games(id) ON UPDATE CASCADE
);
```

#### players

```sql
CREATE TABLE public.players (
  id uuid NOT NULL,
  username text NOT NULL,
  usertag character varying NOT NULL DEFAULT ''::character varying,
  avatar text NULL,
  language text NULL DEFAULT 'fr'::text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  categories jsonb NULL DEFAULT '["animals", "archaeology", "arts", "graphic_and_animated", "celebrities", "cinema", "bulk_culture", "general_culture", "gastronomy", "geography", "history", "computing", "literature", "games", "music", "nature", "daily_life", "sciences", "sports", "television", "tourism", "web"]'::jsonb,
  stats jsonb NULL DEFAULT '{"easy": {"nb_games": 0, "nb_rounds": 0, "best_score": 0}, "hard": {"nb_games": 0, "nb_rounds": 0, "best_score": 0}, "medium": {"nb_games": 0, "nb_rounds": 0, "best_score": 0}}'::jsonb,
  status text NULL DEFAULT 'offline'::text,
  lobby_id smallint NULL,
  last_active_at date NULL,
  CONSTRAINT players_pkey PRIMARY KEY (id),
  CONSTRAINT players_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id) ON UPDATE CASCADE ON DELETE CASCADE,
  CONSTRAINT players_lobby_id_fkey FOREIGN KEY (lobby_id) REFERENCES lobbies(id) ON UPDATE CASCADE ON DELETE SET NULL
);
```

#### quizzes

```sql
CREATE TABLE public.quizzes (
  theme_id bigint NOT NULL,
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  theme text NOT NULL,
  category text NOT NULL,
  question text NULL,
  answers jsonb[] NULL,
  difficulty public.difficulties NULL,
  anecdote text NULL,
  wiki text NULL,
  nb_count numeric NULL DEFAULT '1'::numeric,
  language public.languages NOT NULL DEFAULT 'fr'::languages,
  type public.types NOT NULL DEFAULT 'open'::types,
  metadata jsonb NULL,
  CONSTRAINT quizzes_pkey PRIMARY KEY (id, language, theme_id)
);
```

### üßæ Types ENUM

* `public.languages` : Langues disponibles (ex: `'fr'`, `'en'`, ...)
* `public.difficulties` : Niveaux de difficult√© (`'easy'`, `'medium'`, `'hard'`, ...)
* `public.types` : Types de question (`'open'`, `'mcq'`, ...)

## üß† Fonctions SQL

#### add_friend

```sql
CREATE OR REPLACE FUNCTION public.add_friend(user_uuid uuid, friend_uuid uuid)
RETURNS void AS $$
BEGIN
  INSERT INTO public.friendship (user_id, friend_id, status)
  VALUES (user_uuid, friend_uuid, 'pending')
  ON CONFLICT (user_id, friend_id) DO NOTHING;
END;
$$ LANGUAGE plpgsql;
````

#### accept\_friend\_request

```sql
CREATE OR REPLACE FUNCTION public.accept_friend_request(user_uuid uuid, friend_uuid uuid)
RETURNS void AS $$
BEGIN
  UPDATE public.friendship
  SET status = 'accepted'
  WHERE user_id = friend_uuid AND friend_id = user_uuid AND status = 'pending';
END;
$$ LANGUAGE plpgsql;
```

#### create\_lobby

```sql
CREATE OR REPLACE FUNCTION public.create_lobby(
  lobby_title text,
  host_uuid uuid,
  is_public boolean DEFAULT false,
  friends_only boolean DEFAULT false,
  max_players smallint DEFAULT 12
)
RETURNS smallint AS $$
DECLARE
  new_lobby_id smallint;
BEGIN
  INSERT INTO public.lobbies (title, host, is_public, friends_only, max_players, players)
  VALUES (lobby_title, host_uuid, is_public, friends_only, max_players, ARRAY[host_uuid])
  RETURNING id INTO new_lobby_id;
  RETURN new_lobby_id;
END;
$$ LANGUAGE plpgsql;
```

#### add\_player\_to\_lobby

```sql
CREATE OR REPLACE FUNCTION public.add_player_to_lobby(lobby_id smallint, player_uuid uuid)
RETURNS void AS $$
BEGIN
  UPDATE public.lobbies
  SET players = array_append(players, player_uuid)
  WHERE id = lobby_id AND player_uuid <> ALL(players);
END;
$$ LANGUAGE plpgsql;
```

#### start\_game

```sql
CREATE OR REPLACE FUNCTION public.start_game(lobby_id smallint)
RETURNS bigint AS $$
DECLARE
  new_game_id bigint;
  lobby_players uuid[];
BEGIN
  SELECT players INTO lobby_players FROM public.lobbies WHERE id = lobby_id;
  
  INSERT INTO public.games (phase, players_data)
  VALUES ('started', ARRAY[]::jsonb[])
  RETURNING id INTO new_game_id;

  UPDATE public.lobbies SET game_id = new_game_id WHERE id = lobby_id;

  RETURN new_game_id;
END;
$$ LANGUAGE plpgsql;
```

#### get\_quizzes\_by\_theme\_lang

```sql
CREATE OR REPLACE FUNCTION public.get_quizzes_by_theme_lang(theme bigint, lang public.languages)
RETURNS SETOF public.quizzes AS $$
BEGIN
  RETURN QUERY
  SELECT * FROM public.quizzes
  WHERE theme_id = theme AND language = lang;
END;
$$ LANGUAGE plpgsql;
```

#### update\_player\_status

```sql
CREATE OR REPLACE FUNCTION public.update_player_status(player_uuid uuid, new_status text)
RETURNS void AS $$
BEGIN
  UPDATE public.players SET status = new_status WHERE id = player_uuid;
END;
$$ LANGUAGE plpgsql;
```

## üß™ Tests & Qualit√©

* **ESLint** configur√© avec `eslint.config.mjs` (flat config)
* **Prettier** int√©gr√©
* **Zod** pour la validation des types runtime
* **TypeScript** strict

## üßë‚Äçüíª Contribuer

1.  Forkez le projet.
2.  Cr√©ez une branche pour votre fonctionnalit√© (`git checkout -b feature/AmazingFeature`).
3.  Commitez vos changements (`git commit -m 'Add some AmazingFeature'`).
4.  Poussez vers la branche (`git push origin feature/AmazingFeature`).
5.  Ouvrez une Pull Request.

## üìÆ Contact

Vous voulez discuter, proposer une id√©e ou rejoindre le projet ?
Vous puvez contacter l‚Äôauteur du projet :

* GitHub : [@alexisdechiara](https://github.com/alexisdechiara)
* Site : [Porfolio](https://alexisdechiara.fr)

## üßæ Licences

Ce projet est sous licence [GPLv3](/LICENSE.txt) et l'ensenble des d√©pendances sont list√©es automatiquement via le script :

```bash
bun run generate-licenses
```

Ce script utilise `license-checker` pour g√©n√©rer un `public/licenses.json`.
